# 模块 5: 完整项目实战

## 🎯 学习目标

- 理解完整项目的架构
- 学会阅读和分析现有代码
- 掌握项目扩展和定制方法

## 📖 项目架构总览

经过前面的学习，你已经具备了理解整个项目的知识。让我们把所有知识串起来：

```
┌─────────────────────────────────────────────────────────────┐
│                    SYSU Chat 架构图                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   浏览器 (前端)                    服务器 (后端)              │
│   ┌─────────────┐                 ┌─────────────┐           │
│   │ index.html  │                 │ WebChat     │           │
│   │ style.css   │                 │ Server.java │           │
│   │ chat.js     │                 │             │           │
│   └─────────────┘                 └─────────────┘           │
│         │                               │                   │
│         │  1. 打开网页 (GET /)          │                   │
│         │ ──────────────────────────► │                     │
│         │ ◄─────── HTML/CSS/JS ──────  │                   │
│         │                               │                   │
│         │  2. 建立 SSE (GET /events)    │                   │
│         │ ─────────────────────────────►│                   │
│         │ ◄──── 持续推送消息 ─────────── │                   │
│         │                               │                   │
│         │  3. 发送消息 (POST /send)     │                   │
│         │ ──────────────────────────► │                     │
│         │         广播给所有客户端  ────►│                   │
│         │                               │                   │
└─────────────────────────────────────────────────────────────┘
```

## 📁 项目文件详解

### 后端文件

| 文件 | 作用 | 你学过的知识 |
|------|------|-------------|
| `WebChatServer.java` | 主服务器 | 模块1-3 全部 |
| `HttpChatServer.java` | 简化版 | 模块2-3 |
| `ChatServer.java` | Socket版 | 模块1 |

### 前端文件

| 文件 | 作用 | 你学过的知识 |
|------|------|-------------|
| `web/index.html` | 页面结构 | 模块4 HTML |
| `web/css/style.css` | 样式 | 模块4 CSS |
| `web/js/config.js` | 配置 | 模块4 JS |
| `web/js/chat.js` | 核心逻辑 | 模块4 全部 |

## 🔍 代码分析任务

### 任务1: 分析 WebChatServer.java

打开 `src/WebChatServer.java`，找到并理解：

1. **静态文件处理器** (StaticFileHandler)
   - 如何根据 URL 找到文件？
   - 如何确定 Content-Type？

2. **SSE 处理器** (EventsHandler)
   - 如何维护客户端列表？
   - 心跳机制是怎么实现的？

3. **消息处理器** (SendHandler)
   - 如何解析 JSON？
   - 广播是怎么实现的？

### 任务2: 分析 chat.js

打开 `web/js/chat.js`，找到并理解：

1. **ChatApp 类结构**
   - 有哪些属性？
   - 有哪些方法？

2. **SSE 连接管理**
   - `connect()` 方法做了什么？
   - 断线重连是怎么实现的？

3. **消息渲染**
   - `addChatMessage()` 做了什么？
   - 如何区分自己和别人的消息？

## 🛠 扩展练习

### 练习1: 添加"正在输入"提示 ⭐⭐

当用户正在输入时，通知其他人。

提示：
- 前端：检测 input 事件
- 后端：新增 /typing 端点
- 用 SSE 自定义事件推送

### 练习2: 添加私聊功能 ⭐⭐⭐

实现 `/msg 昵称 消息` 命令，只发给特定用户。

提示：
- 需要记录每个连接的昵称
- 解析消息判断是否是命令
- 只发送给目标用户

### 练习3: 添加消息历史 ⭐⭐⭐

新用户加入时，发送最近10条消息。

提示：
- 服务端用 List 存储历史消息
- 连接时发送历史消息
- 限制历史消息数量

### 练习4: 添加房间功能 ⭐⭐⭐⭐

支持多个聊天房间。

提示：
- 修改 SSE 端点：/events?room=xxx
- 按房间分组管理客户端
- 只广播给同一房间的用户

## 📋 代码规范

好的代码应该：

```java
// ✅ 好的代码
public void broadcast(String message) {
    synchronized (clients) {
        clients.removeIf(client -> !client.send(message));
    }
}

// ❌ 不好的代码
public void b(String m) {
    for(var c:cs) c.s(m);
}
```

1. **命名清晰** - 变量/方法名要表达意图
2. **注释适当** - 复杂逻辑要有注释
3. **结构整齐** - 相关代码放在一起
4. **错误处理** - 不要忽略异常

## ✅ 检验标准

完成这个模块后，你应该能够：

- [ ] 解释项目的整体架构
- [ ] 阅读并理解后端代码
- [ ] 阅读并理解前端代码
- [ ] 独立添加新功能
- [ ] 调试和修复问题

## 🎉 恭喜完成！

你已经完成了所有学习模块！现在你应该能够：

1. ✅ 理解 Socket 网络编程
2. ✅ 理解 HTTP 协议和服务器
3. ✅ 理解 SSE 实时通讯
4. ✅ 理解前端开发基础
5. ✅ 理解完整的聊天室项目

### 下一步建议

1. **动手实践** - 尝试扩展练习
2. **阅读源码** - 深入理解每一行代码
3. **独立项目** - 尝试从零创建类似项目
4. **学习进阶** - WebSocket、数据库、用户认证

---

*学习永无止境，加油！* 🚀
