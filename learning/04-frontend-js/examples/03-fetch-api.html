<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Fetch API å­¦ä¹ </title>
    <style>
        body { font-family: Arial; padding: 20px; max-width: 800px; margin: 0 auto; }
        h1 { color: #006633; }
        .demo-box { border: 2px solid #ddd; padding: 20px; margin: 20px 0; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #006633; color: white; border: none; border-radius: 4px; }
        button:hover { background: #004d26; }
        .code { background: #f0f0f0; padding: 15px; font-family: monospace; margin: 10px 0; border-radius: 4px; white-space: pre; overflow-x: auto; }
        #result { background: #f5f5f5; padding: 15px; margin-top: 10px; border-radius: 4px; min-height: 100px; }
        .loading { color: #666; font-style: italic; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>ğŸ“¡ Fetch API å­¦ä¹ </h1>
    <p>Fetch API ç”¨äºå‘é€ HTTP è¯·æ±‚ï¼Œæ˜¯ XMLHttpRequest çš„ç°ä»£æ›¿ä»£æ–¹æ¡ˆã€‚</p>
    
    <!-- ç¤ºä¾‹1: GET è¯·æ±‚ -->
    <div class="demo-box">
        <h3>1. GET è¯·æ±‚ - è·å–æ•°æ®</h3>
        <div class="code">// è·å– JSON æ•°æ®
const response = await fetch('https://api.example.com/data');
const data = await response.json();
console.log(data);</div>
        <button onclick="fetchPublicApi()">è·å–å…¬å¼€ API æ•°æ®</button>
        <button onclick="fetchLocalTime()">è·å–æœ¬åœ°æ—¶é—´API</button>
        <div id="getResult" class="result"></div>
    </div>
    
    <!-- ç¤ºä¾‹2: POST è¯·æ±‚ -->
    <div class="demo-box">
        <h3>2. POST è¯·æ±‚ - å‘é€æ•°æ®</h3>
        <div class="code">// å‘é€ JSON æ•°æ®
await fetch('/api/send', {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json'
    },
    body: JSON.stringify({
        name: 'å¼ ä¸‰',
        message: 'ä½ å¥½'
    })
});</div>
        <p>è¿™å°±æ˜¯èŠå¤©å®¤å‘é€æ¶ˆæ¯çš„æ–¹å¼ï¼</p>
        <input type="text" id="postName" placeholder="æ˜µç§°" value="å­¦ç”Ÿ">
        <input type="text" id="postMessage" placeholder="æ¶ˆæ¯">
        <button onclick="simulatePost()">æ¨¡æ‹Ÿå‘é€</button>
        <div id="postResult"></div>
    </div>
    
    <!-- ç¤ºä¾‹3: é”™è¯¯å¤„ç† -->
    <div class="demo-box">
        <h3>3. é”™è¯¯å¤„ç†</h3>
        <div class="code">try {
    const response = await fetch('/api/data');
    if (!response.ok) {
        throw new Error('HTTP ' + response.status);
    }
    const data = await response.json();
} catch (error) {
    console.error('è¯·æ±‚å¤±è´¥:', error);
}</div>
        <button onclick="fetchSuccess()">æˆåŠŸè¯·æ±‚</button>
        <button onclick="fetchError()">å¤±è´¥è¯·æ±‚ (404)</button>
        <button onclick="fetchNetworkError()">ç½‘ç»œé”™è¯¯</button>
        <div id="errorResult"></div>
    </div>
    
    <!-- ç¤ºä¾‹4: èŠå¤©å®¤å®æˆ˜ -->
    <div class="demo-box" style="background: #e8f5e9;">
        <h3>4. ğŸ¯ èŠå¤©å®¤å‘é€æ¶ˆæ¯ï¼ˆå®æˆ˜ï¼‰</h3>
        <p>è¿™æ˜¯èŠå¤©å®¤å‰ç«¯å‘é€æ¶ˆæ¯çš„å®Œæ•´ä»£ç ï¼š</p>
        <div class="code">async function sendMessage() {
    const name = document.getElementById('nickname').value;
    const message = document.getElementById('message').value;
    
    const response = await fetch('/send', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify({ name, message })
    });
    
    if (response.ok) {
        document.getElementById('message').value = '';
    } else {
        alert('å‘é€å¤±è´¥');
    }
}</div>
    </div>

    <div id="result"></div>

    <script>
        // ========== ç¤ºä¾‹1: GET è¯·æ±‚ ==========
        async function fetchPublicApi() {
            const resultDiv = document.getElementById('getResult');
            resultDiv.innerHTML = '<span class="loading">åŠ è½½ä¸­...</span>';
            
            try {
                // ä½¿ç”¨å…è´¹çš„å…¬å¼€ API
                const response = await fetch('https://httpbin.org/json');
                const data = await response.json();
                
                resultDiv.innerHTML = '<span class="success">âœ… æˆåŠŸè·å–æ•°æ®:</span><pre>' + 
                    JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                resultDiv.innerHTML = '<span class="error">âŒ é”™è¯¯: ' + error.message + '</span>';
            }
        }
        
        async function fetchLocalTime() {
            const resultDiv = document.getElementById('getResult');
            resultDiv.innerHTML = '<span class="loading">è¯·æ±‚ä¸­...</span>';
            
            try {
                // å°è¯•æœ¬åœ°æœåŠ¡å™¨ï¼ˆå¦‚æœ ChatSSEServer åœ¨è¿è¡Œï¼‰
                const response = await fetch('http://localhost:8080/api/status', {
                    mode: 'cors'
                });
                const data = await response.json();
                resultDiv.innerHTML = '<span class="success">âœ… æœ¬åœ°æœåŠ¡å™¨å“åº”:</span><pre>' + 
                    JSON.stringify(data, null, 2) + '</pre>';
            } catch (error) {
                resultDiv.innerHTML = '<span class="error">âŒ æœ¬åœ°æœåŠ¡å™¨æœªè¿è¡Œ<br>æç¤º: å…ˆè¿è¡Œ ChatSSEServer</span>';
            }
        }
        
        // ========== ç¤ºä¾‹2: POST è¯·æ±‚ ==========
        async function simulatePost() {
            const name = document.getElementById('postName').value || 'åŒ¿å';
            const message = document.getElementById('postMessage').value || 'æµ‹è¯•æ¶ˆæ¯';
            const resultDiv = document.getElementById('postResult');
            
            // æ„é€ è¯·æ±‚æ•°æ®
            const requestData = {
                name: name,
                message: message
            };
            
            resultDiv.innerHTML = '<span class="loading">å‘é€ä¸­...</span>';
            
            // æ˜¾ç¤ºå°†è¦å‘é€çš„æ•°æ®
            resultDiv.innerHTML = `
                <p><strong>è¯·æ±‚æ–¹æ³•:</strong> POST</p>
                <p><strong>è¯·æ±‚å¤´:</strong> Content-Type: application/json</p>
                <p><strong>è¯·æ±‚ä½“:</strong></p>
                <pre>${JSON.stringify(requestData, null, 2)}</pre>
                <p class="success">âœ… è¿™å°±æ˜¯å‘é€ç»™èŠå¤©æœåŠ¡å™¨çš„æ•°æ®æ ¼å¼ï¼</p>
            `;
        }
        
        // ========== ç¤ºä¾‹3: é”™è¯¯å¤„ç† ==========
        async function fetchSuccess() {
            const resultDiv = document.getElementById('errorResult');
            resultDiv.innerHTML = '<span class="loading">è¯·æ±‚ä¸­...</span>';
            
            try {
                const response = await fetch('https://httpbin.org/status/200');
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status);
                }
                resultDiv.innerHTML = '<span class="success">âœ… è¯·æ±‚æˆåŠŸ! çŠ¶æ€ç : ' + response.status + '</span>';
            } catch (error) {
                resultDiv.innerHTML = '<span class="error">âŒ ' + error.message + '</span>';
            }
        }
        
        async function fetchError() {
            const resultDiv = document.getElementById('errorResult');
            resultDiv.innerHTML = '<span class="loading">è¯·æ±‚ä¸­...</span>';
            
            try {
                const response = await fetch('https://httpbin.org/status/404');
                if (!response.ok) {
                    throw new Error('HTTP ' + response.status + ' - é¡µé¢ä¸å­˜åœ¨');
                }
                resultDiv.innerHTML = '<span class="success">âœ… æˆåŠŸ</span>';
            } catch (error) {
                resultDiv.innerHTML = '<span class="error">âŒ æ•è·åˆ°é”™è¯¯: ' + error.message + '</span>';
            }
        }
        
        async function fetchNetworkError() {
            const resultDiv = document.getElementById('errorResult');
            resultDiv.innerHTML = '<span class="loading">è¯·æ±‚ä¸­...</span>';
            
            try {
                // è¯·æ±‚ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€
                const response = await fetch('http://localhost:99999/notexist');
                resultDiv.innerHTML = '<span class="success">âœ… æˆåŠŸ</span>';
            } catch (error) {
                resultDiv.innerHTML = '<span class="error">âŒ ç½‘ç»œé”™è¯¯: ' + error.message + '<br>è¿™é€šå¸¸è¡¨ç¤ºæœåŠ¡å™¨æœªè¿è¡Œæˆ–åœ°å€é”™è¯¯</span>';
            }
        }
    </script>
</body>
</html>
