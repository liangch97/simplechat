# æ¨¡å— 3: SSE å®æ—¶é€šè®¯

## ğŸ¯ å­¦ä¹ ç›®æ ‡

- ç†è§£å®æ—¶é€šè®¯çš„å‡ ç§æ–¹æ¡ˆ
- æŒæ¡ SSE (Server-Sent Events) çš„åŸç†
- å­¦ä¼šå®ç°æœåŠ¡å™¨æ¨é€åŠŸèƒ½

## ğŸ“– æ ¸å¿ƒæ¦‚å¿µ

### ä¸ºä»€ä¹ˆéœ€è¦å®æ—¶é€šè®¯ï¼Ÿ

ä¼ ç»Ÿ HTTP æ˜¯**è¯·æ±‚-å“åº”**æ¨¡å¼ï¼š
- å®¢æˆ·ç«¯å‘è¯·æ±‚ â†’ æœåŠ¡å™¨è¿”å›å“åº” â†’ è¿æ¥å…³é—­
- é—®é¢˜ï¼šæœåŠ¡å™¨æ— æ³•ä¸»åŠ¨æ¨é€æ¶ˆæ¯ç»™å®¢æˆ·ç«¯

èŠå¤©å®¤éœ€è¦**å®æ—¶æ¨é€**ï¼šå½“æœ‰äººå‘æ¶ˆæ¯æ—¶ï¼Œæ‰€æœ‰äººç«‹åˆ»æ”¶åˆ°ã€‚

### å®æ—¶é€šè®¯æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | åŸç† | ä¼˜ç‚¹ | ç¼ºç‚¹ |
|------|------|------|------|
| **è½®è¯¢ (Polling)** | å®¢æˆ·ç«¯æ¯ç§’è¯·æ±‚ä¸€æ¬¡ | ç®€å• | æµªè´¹èµ„æºã€å»¶è¿Ÿé«˜ |
| **é•¿è½®è¯¢** | æœåŠ¡å™¨holdè¯·æ±‚ç›´åˆ°æœ‰æ•°æ® | è¾ƒä½å»¶è¿Ÿ | å®ç°å¤æ‚ |
| **SSE** | æœåŠ¡å™¨æŒç»­æ¨é€ | ç®€å•é«˜æ•ˆ | å•å‘ï¼ˆæœåŠ¡å™¨â†’å®¢æˆ·ç«¯ï¼‰ |
| **WebSocket** | å…¨åŒå·¥è¿æ¥ | åŒå‘å®æ—¶ | è¾ƒå¤æ‚ |

### SSE æ˜¯ä»€ä¹ˆï¼Ÿ

SSE (Server-Sent Events) æ˜¯ HTML5 æ ‡å‡†ï¼Œè®©æœåŠ¡å™¨å¯ä»¥**æŒç»­æ¨é€**æ•°æ®ç»™æµè§ˆå™¨ã€‚

```
æµè§ˆå™¨                              æœåŠ¡å™¨
   â”‚                                  â”‚
   â”‚  â”€â”€â”€ GET /events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚
   â”‚                                  â”‚
   â”‚  â—„â”€â”€ Content-Type: text/event-stream
   â”‚                                  â”‚
   â”‚  â—„â”€â”€ data: æ¶ˆæ¯1                  â”‚
   â”‚  â—„â”€â”€ data: æ¶ˆæ¯2                  â”‚ (è¿æ¥ä¿æŒ)
   â”‚  â—„â”€â”€ data: æ¶ˆæ¯3                  â”‚
   â”‚  ...                             â”‚
```

### SSE æ•°æ®æ ¼å¼

```
data: è¿™æ˜¯ä¸€æ¡æ¶ˆæ¯\n\n

data: å¤šè¡Œæ¶ˆæ¯\n
data: ç¬¬äºŒè¡Œ\n\n

event: custom\n
data: è‡ªå®šä¹‰äº‹ä»¶\n\n

id: 123\n
data: å¸¦IDçš„æ¶ˆæ¯\n\n
```

å…³é”®ç‚¹ï¼š
- æ¯æ¡æ¶ˆæ¯ä»¥ `\n\n`ï¼ˆä¸¤ä¸ªæ¢è¡Œï¼‰ç»“æŸ
- `data:` å‰ç¼€è¡¨ç¤ºæ¶ˆæ¯å†…å®¹
- `event:` å¯æŒ‡å®šè‡ªå®šä¹‰äº‹ä»¶ç±»å‹
- `id:` æ¶ˆæ¯IDï¼ˆç”¨äºæ–­çº¿é‡è¿ï¼‰

### JavaScript æ¥æ”¶ SSE

```javascript
// åˆ›å»º SSE è¿æ¥
const eventSource = new EventSource('/events');

// æ¥æ”¶æ¶ˆæ¯
eventSource.onmessage = function(event) {
    console.log('æ”¶åˆ°:', event.data);
};

// æ¥æ”¶è‡ªå®šä¹‰äº‹ä»¶
eventSource.addEventListener('custom', function(event) {
    console.log('è‡ªå®šä¹‰äº‹ä»¶:', event.data);
});

// è¿æ¥çŠ¶æ€
eventSource.onopen = () => console.log('å·²è¿æ¥');
eventSource.onerror = () => console.log('è¿æ¥é”™è¯¯');
```

## ğŸ“ æœ¬æ¨¡å—æ–‡ä»¶

```
03-sse-realtime/
â”œâ”€â”€ README.md                    # æœ¬æ–‡æ¡£
â”œâ”€â”€ examples/
â”‚   â”œâ”€â”€ SimpleSSEServer.java     # æœ€ç®€å•çš„ SSE æœåŠ¡å™¨
â”‚   â”œâ”€â”€ ChatSSEServer.java       # èŠå¤©å®¤ SSE æœåŠ¡å™¨
â”‚   â””â”€â”€ sse-client.html          # å‰ç«¯æµ‹è¯•é¡µé¢
â””â”€â”€ exercises/
    â””â”€â”€ Exercise3.md
```

## â–¶ï¸ ä¸‹ä¸€æ­¥

æŸ¥çœ‹ [examples/SimpleSSEServer.java](./examples/SimpleSSEServer.java) å¼€å§‹å­¦ä¹ ï¼
